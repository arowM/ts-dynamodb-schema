/**
 * Type safe schema for DynamoDB.
 * @module
 */
import * as marshaller from "@aws/dynamodb-data-marshaller";
// import {unmarshallItem, marshallValue} from "@aws/dynamodb-data-marshaller";
/**
 * Schema
 */
export class Schema {
}
class BinarySchema extends Schema {
    constructor() {
        super();
    }
    serializeItem() {
        return { type: "Binary" };
    }
}
/**
 * Binary Schema
 */
export const buffer = () => new BinarySchema();
class BooleanSchema extends Schema {
    constructor() {
        super();
    }
    serializeItem() {
        return { type: "Boolean" };
    }
}
/**
 * Boolean Schema
 */
export const boolean = () => new BooleanSchema();
class DateSchema extends Schema {
    constructor() {
        super();
    }
    serializeItem() {
        return { type: "Date" };
    }
}
/**
 * Date Schema
 */
export const date = () => new DateSchema();
class NumberSchema extends Schema {
    constructor() {
        super();
    }
    serializeItem() {
        return { type: "Number" };
    }
}
/**
 * Number Schema.
 */
export const number = () => new NumberSchema();
class StringSchema extends Schema {
    constructor() {
        super();
    }
    serializeItem() {
        return { type: "String" };
    }
}
/**
 * String Schema.
 */
export const string = () => new StringSchema();
class ArraySchema extends Schema {
    constructor(schema) {
        super();
        this._schema = schema;
    }
    serializeItem() {
        return {
            type: "List",
            memberType: this._schema.serializeItem(),
        };
    }
}
/**
 * Array Schema
 */
export function array(item) {
    return new ArraySchema(item);
}
class MapSchema extends Schema {
    constructor(schema) {
        super();
        this._schema = schema;
    }
    serializeItem() {
        return {
            type: "Map",
            memberType: this._schema.serializeItem(),
        };
    }
}
/**
 * Map Schema
 */
export function map(item) {
    return new MapSchema(item);
}
class SetSchema extends Schema {
    constructor(schema) {
        super();
        this._schema = schema;
    }
    memberType() {
        if (this._schema instanceof BinarySchema) {
            return "Binary";
        }
        if (this._schema instanceof NumberSchema) {
            return "Number";
        }
        if (this._schema instanceof StringSchema) {
            return "String";
        }
        throw new Error("Invalid Set");
    }
    serializeItem() {
        return {
            type: "Set",
            memberType: this.memberType(),
        };
    }
}
/**
 * Set Schema
 */
export function set(item) {
    return new SetSchema(item);
}
class NullableSchema extends Schema {
    constructor(schema) {
        super();
        this._schema = schema;
    }
    marshall(input) {
        if (input === null) {
            return {
                NULL: true,
            };
        }
        const serialized = marshaller.marshallValue(this._schema.serializeItem(), input);
        if (serialized === void 0) {
            throw new Error("Failed to marshallValue");
        }
        return serialized;
    }
    unmarshall(input) {
        if ("NULL" in input) {
            return null;
        }
        const deserialized = marshaller.unmarshallItem({ foo: this._schema.serializeItem() }, { foo: input });
        return deserialized.foo;
    }
    serializeItem() {
        return {
            type: "Custom",
            marshall: this.marshall.bind(this),
            unmarshall: this.unmarshall.bind(this),
        };
    }
}
/**
 * Nullable Schema
 */
export function nullable(item) {
    return new NullableSchema(item);
}
/**
 * Object Schema
 */
// eslint-disable-next-line @typescript-eslint/no-explicit-any
export class ObjectSchema extends Schema {
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    constructor(schema) {
        super();
        this._schema = schema;
    }
    /** Asign required field.
     *
     * Note that `Schema` cannot handle objects with any optional fields.
     */
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    field(name, schema) {
        return new ObjectSchema([
            ...this._schema,
            [name, schema],
        ]);
    }
    serializeValue() {
        return Object.fromEntries(this._schema.map(([key, schema]) => [key, schema.serializeItem()]));
    }
    serializeItem() {
        return {
            type: "Document",
            members: this.serializeValue(),
        };
    }
    marshallItem(input) {
        return marshaller.marshallItem(this.serializeValue(), input);
    }
    unmarshallItem(input) {
        const ret = marshaller.unmarshallItem(this.serializeValue(), input);
        // It seems that marshaller.unmarshallItem has a bug...
        this._schema.forEach(([key]) => {
            if (!(key in ret)) {
                throw new Error('Required Attribute "' + key.toString() + '" is not found.');
            }
        });
        return ret;
    }
}
// eslint-disable-next-line @typescript-eslint/ban-types
ObjectSchema.entry = new ObjectSchema([]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztHQUdHO0FBR0gsT0FBTyxLQUFLLFVBQVUsTUFBTSwrQkFBK0IsQ0FBQztBQUM1RCwrRUFBK0U7QUFFL0U7O0dBRUc7QUFDSCxNQUFNLE9BQWdCLE1BQU07Q0FHM0I7QUFRRCxNQUFNLFlBQWEsU0FBUSxNQUFxQztJQUM5RDtRQUNFLEtBQUssRUFBRSxDQUFDO0lBQ1YsQ0FBQztJQUNNLGFBQWE7UUFDbEIsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQztJQUM1QixDQUFDO0NBQ0Y7QUFFRDs7R0FFRztBQUNILE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBZ0QsR0FBRyxFQUFFLENBQ3RFLElBQUksWUFBWSxFQUFFLENBQUM7QUFFckIsTUFBTSxhQUFjLFNBQVEsTUFBZTtJQUN6QztRQUNFLEtBQUssRUFBRSxDQUFDO0lBQ1YsQ0FBQztJQUNNLGFBQWE7UUFDbEIsT0FBTyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsQ0FBQztJQUM3QixDQUFDO0NBQ0Y7QUFFRDs7R0FFRztBQUNILE1BQU0sQ0FBQyxNQUFNLE9BQU8sR0FBMEIsR0FBRyxFQUFFLENBQUMsSUFBSSxhQUFhLEVBQUUsQ0FBQztBQUV4RSxNQUFNLFVBQVcsU0FBUSxNQUFZO0lBQ25DO1FBQ0UsS0FBSyxFQUFFLENBQUM7SUFDVixDQUFDO0lBQ00sYUFBYTtRQUNsQixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDO0lBQzFCLENBQUM7Q0FDRjtBQUVEOztHQUVHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sSUFBSSxHQUF1QixHQUFHLEVBQUUsQ0FBQyxJQUFJLFVBQVUsRUFBRSxDQUFDO0FBRS9ELE1BQU0sWUFBYSxTQUFRLE1BQWM7SUFDdkM7UUFDRSxLQUFLLEVBQUUsQ0FBQztJQUNWLENBQUM7SUFDTSxhQUFhO1FBQ2xCLE9BQU8sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUM7SUFDNUIsQ0FBQztDQUNGO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQXlCLEdBQUcsRUFBRSxDQUFDLElBQUksWUFBWSxFQUFFLENBQUM7QUFFckUsTUFBTSxZQUFhLFNBQVEsTUFBYztJQUN2QztRQUNFLEtBQUssRUFBRSxDQUFDO0lBQ1YsQ0FBQztJQUNNLGFBQWE7UUFDbEIsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQztJQUM1QixDQUFDO0NBQ0Y7QUFFRDs7R0FFRztBQUNILE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBeUIsR0FBRyxFQUFFLENBQUMsSUFBSSxZQUFZLEVBQUUsQ0FBQztBQUVyRSxNQUFNLFdBQWUsU0FBUSxNQUFXO0lBRXRDLFlBQVksTUFBaUI7UUFDM0IsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztJQUN4QixDQUFDO0lBQ00sYUFBYTtRQUNsQixPQUFPO1lBQ0wsSUFBSSxFQUFFLE1BQU07WUFDWixVQUFVLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUU7U0FDekMsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLEtBQUssQ0FBSSxJQUFlO0lBQ3RDLE9BQU8sSUFBSSxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDL0IsQ0FBQztBQUVELE1BQU0sU0FBYSxTQUFRLE1BQXNCO0lBRS9DLFlBQVksTUFBaUI7UUFDM0IsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztJQUN4QixDQUFDO0lBQ00sYUFBYTtRQUNsQixPQUFPO1lBQ0wsSUFBSSxFQUFFLEtBQUs7WUFDWCxVQUFVLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUU7U0FDekMsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLEdBQUcsQ0FBSSxJQUFlO0lBQ3BDLE9BQU8sSUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDN0IsQ0FBQztBQUVELE1BQU0sU0FFSixTQUFRLE1BQWM7SUFFdEIsWUFBWSxNQUFpQjtRQUMzQixLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO0lBQ3hCLENBQUM7SUFFTyxVQUFVO1FBQ2hCLElBQUksSUFBSSxDQUFDLE9BQU8sWUFBWSxZQUFZLEVBQUU7WUFDeEMsT0FBTyxRQUFRLENBQUM7U0FDakI7UUFDRCxJQUFJLElBQUksQ0FBQyxPQUFPLFlBQVksWUFBWSxFQUFFO1lBQ3hDLE9BQU8sUUFBUSxDQUFDO1NBQ2pCO1FBQ0QsSUFBSSxJQUFJLENBQUMsT0FBTyxZQUFZLFlBQVksRUFBRTtZQUN4QyxPQUFPLFFBQVEsQ0FBQztTQUNqQjtRQUNELE1BQU0sSUFBSSxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUNNLGFBQWE7UUFDbEIsT0FBTztZQUNMLElBQUksRUFBRSxLQUFLO1lBQ1gsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUU7U0FDOUIsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLEdBQUcsQ0FDakIsSUFBZTtJQUVmLE9BQU8sSUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDN0IsQ0FBQztBQUVELE1BQU0sY0FBa0IsU0FBUSxNQUFnQjtJQUU5QyxZQUFZLE1BQWlCO1FBQzNCLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7SUFDeEIsQ0FBQztJQUVPLFFBQVEsQ0FBQyxLQUFlO1FBQzlCLElBQUksS0FBSyxLQUFLLElBQUksRUFBRTtZQUNsQixPQUFPO2dCQUNMLElBQUksRUFBRSxJQUFJO2FBQ1gsQ0FBQztTQUNIO1FBRUQsTUFBTSxVQUFVLEdBQStCLFVBQVUsQ0FBQyxhQUFhLENBQ3JFLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQzVCLEtBQUssQ0FDTixDQUFDO1FBQ0YsSUFBSSxVQUFVLEtBQUssS0FBSyxDQUFDLEVBQUU7WUFDekIsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1NBQzVDO1FBQ0QsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQztJQUVPLFVBQVUsQ0FBQyxLQUFxQjtRQUN0QyxJQUFJLE1BQU0sSUFBSSxLQUFLLEVBQUU7WUFDbkIsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELE1BQU0sWUFBWSxHQUFlLFVBQVUsQ0FBQyxjQUFjLENBQ3hELEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUUsRUFDckMsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLENBQ2YsQ0FBQztRQUNGLE9BQU8sWUFBWSxDQUFDLEdBQUcsQ0FBQztJQUMxQixDQUFDO0lBRU0sYUFBYTtRQUNsQixPQUFPO1lBQ0wsSUFBSSxFQUFFLFFBQVE7WUFDZCxRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ2xDLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDdkMsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLFFBQVEsQ0FBSSxJQUFlO0lBQ3pDLE9BQU8sSUFBSSxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDbEMsQ0FBQztBQUVEOztHQUVHO0FBQ0gsOERBQThEO0FBQzlELE1BQU0sT0FBTyxZQUErQyxTQUFRLE1BQVM7SUFFM0UsOERBQThEO0lBQzlELFlBQW9CLE1BQXFDO1FBQ3ZELEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7SUFDeEIsQ0FBQztJQUlEOzs7T0FHRztJQUNILDhEQUE4RDtJQUN2RCxLQUFLLENBQ1YsSUFBWSxFQUNaLE1BQTBCO1FBRTFCLE9BQU8sSUFBSSxZQUFZLENBQXFDO1lBQzFELEdBQUcsSUFBSSxDQUFDLE9BQU87WUFDZixDQUFDLElBQUksRUFBRSxNQUFNLENBQUM7U0FDZixDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ00sY0FBYztRQUNuQixPQUFPLE1BQU0sQ0FBQyxXQUFXLENBQ3ZCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDLENBQ25FLENBQUM7SUFDSixDQUFDO0lBQ00sYUFBYTtRQUNsQixPQUFPO1lBQ0wsSUFBSSxFQUFFLFVBQVU7WUFDaEIsT0FBTyxFQUFFLElBQUksQ0FBQyxjQUFjLEVBQUU7U0FDL0IsQ0FBQztJQUNKLENBQUM7SUFDTSxZQUFZLENBQUMsS0FBUTtRQUMxQixPQUFPLFVBQVUsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFDTSxjQUFjLENBQUMsS0FBbUI7UUFDdkMsTUFBTSxHQUFHLEdBQU0sVUFBVSxDQUFDLGNBQWMsQ0FBSSxJQUFJLENBQUMsY0FBYyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDMUUsdURBQXVEO1FBQ3ZELElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFO1lBQzdCLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUMsRUFBRTtnQkFDakIsTUFBTSxJQUFJLEtBQUssQ0FDYixzQkFBc0IsR0FBRyxHQUFHLENBQUMsUUFBUSxFQUFFLEdBQUcsaUJBQWlCLENBQzVELENBQUM7YUFDSDtRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxHQUFHLENBQUM7SUFDYixDQUFDOztBQTFDRCx3REFBd0Q7QUFDMUMsa0JBQUssR0FBcUIsSUFBSSxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFR5cGUgc2FmZSBzY2hlbWEgZm9yIER5bmFtb0RCLlxuICogQG1vZHVsZVxuICovXG5cbmltcG9ydCB0eXBlIHsgQXR0cmlidXRlVmFsdWUsIEF0dHJpYnV0ZU1hcCB9IGZyb20gXCJhd3Mtc2RrL2NsaWVudHMvZHluYW1vZGJcIjtcbmltcG9ydCAqIGFzIG1hcnNoYWxsZXIgZnJvbSBcIkBhd3MvZHluYW1vZGItZGF0YS1tYXJzaGFsbGVyXCI7XG4vLyBpbXBvcnQge3VubWFyc2hhbGxJdGVtLCBtYXJzaGFsbFZhbHVlfSBmcm9tIFwiQGF3cy9keW5hbW9kYi1kYXRhLW1hcnNoYWxsZXJcIjtcblxuLyoqXG4gKiBTY2hlbWFcbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFNjaGVtYTxUPiB7XG4gIHJlYWRvbmx5IF90YXJnZXQhOiBUO1xuICBhYnN0cmFjdCBzZXJpYWxpemVJdGVtKCk6IG1hcnNoYWxsZXIuU2NoZW1hVHlwZTtcbn1cblxuLyoqXG4gKiBJbmZlciB0eXBlIG9mIFNjaGVtYS5cbiAqL1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbmV4cG9ydCB0eXBlIGluZmVyPFMgZXh0ZW5kcyBTY2hlbWE8YW55Pj4gPSBTW1wiX3RhcmdldFwiXTtcblxuY2xhc3MgQmluYXJ5U2NoZW1hIGV4dGVuZHMgU2NoZW1hPEFycmF5QnVmZmVyIHwgQXJyYXlCdWZmZXJWaWV3PiB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gIH1cbiAgcHVibGljIHNlcmlhbGl6ZUl0ZW0oKTogbWFyc2hhbGxlci5TY2hlbWFUeXBlIHtcbiAgICByZXR1cm4geyB0eXBlOiBcIkJpbmFyeVwiIH07XG4gIH1cbn1cblxuLyoqXG4gKiBCaW5hcnkgU2NoZW1hXG4gKi9cbmV4cG9ydCBjb25zdCBidWZmZXI6ICgpID0+IFNjaGVtYTxBcnJheUJ1ZmZlclZpZXcgfCBBcnJheUJ1ZmZlcj4gPSAoKSA9PlxuICBuZXcgQmluYXJ5U2NoZW1hKCk7XG5cbmNsYXNzIEJvb2xlYW5TY2hlbWEgZXh0ZW5kcyBTY2hlbWE8Ym9vbGVhbj4ge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG4gIHB1YmxpYyBzZXJpYWxpemVJdGVtKCk6IG1hcnNoYWxsZXIuU2NoZW1hVHlwZSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJCb29sZWFuXCIgfTtcbiAgfVxufVxuXG4vKipcbiAqIEJvb2xlYW4gU2NoZW1hXG4gKi9cbmV4cG9ydCBjb25zdCBib29sZWFuOiAoKSA9PiBTY2hlbWE8Ym9vbGVhbj4gPSAoKSA9PiBuZXcgQm9vbGVhblNjaGVtYSgpO1xuXG5jbGFzcyBEYXRlU2NoZW1hIGV4dGVuZHMgU2NoZW1hPERhdGU+IHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuICBwdWJsaWMgc2VyaWFsaXplSXRlbSgpOiBtYXJzaGFsbGVyLlNjaGVtYVR5cGUge1xuICAgIHJldHVybiB7IHR5cGU6IFwiRGF0ZVwiIH07XG4gIH1cbn1cblxuLyoqXG4gKiBEYXRlIFNjaGVtYVxuICovXG5leHBvcnQgY29uc3QgZGF0ZTogKCkgPT4gU2NoZW1hPERhdGU+ID0gKCkgPT4gbmV3IERhdGVTY2hlbWEoKTtcblxuY2xhc3MgTnVtYmVyU2NoZW1hIGV4dGVuZHMgU2NoZW1hPG51bWJlcj4ge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICB9XG4gIHB1YmxpYyBzZXJpYWxpemVJdGVtKCk6IG1hcnNoYWxsZXIuU2NoZW1hVHlwZSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJOdW1iZXJcIiB9O1xuICB9XG59XG5cbi8qKlxuICogTnVtYmVyIFNjaGVtYS5cbiAqL1xuZXhwb3J0IGNvbnN0IG51bWJlcjogKCkgPT4gU2NoZW1hPG51bWJlcj4gPSAoKSA9PiBuZXcgTnVtYmVyU2NoZW1hKCk7XG5cbmNsYXNzIFN0cmluZ1NjaGVtYSBleHRlbmRzIFNjaGVtYTxzdHJpbmc+IHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuICBwdWJsaWMgc2VyaWFsaXplSXRlbSgpOiBtYXJzaGFsbGVyLlNjaGVtYVR5cGUge1xuICAgIHJldHVybiB7IHR5cGU6IFwiU3RyaW5nXCIgfTtcbiAgfVxufVxuXG4vKipcbiAqIFN0cmluZyBTY2hlbWEuXG4gKi9cbmV4cG9ydCBjb25zdCBzdHJpbmc6ICgpID0+IFNjaGVtYTxzdHJpbmc+ID0gKCkgPT4gbmV3IFN0cmluZ1NjaGVtYSgpO1xuXG5jbGFzcyBBcnJheVNjaGVtYTxUPiBleHRlbmRzIFNjaGVtYTxUW10+IHtcbiAgcmVhZG9ubHkgX3NjaGVtYSE6IFNjaGVtYTxUPjtcbiAgY29uc3RydWN0b3Ioc2NoZW1hOiBTY2hlbWE8VD4pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3NjaGVtYSA9IHNjaGVtYTtcbiAgfVxuICBwdWJsaWMgc2VyaWFsaXplSXRlbSgpOiBtYXJzaGFsbGVyLlNjaGVtYVR5cGUge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIkxpc3RcIixcbiAgICAgIG1lbWJlclR5cGU6IHRoaXMuX3NjaGVtYS5zZXJpYWxpemVJdGVtKCksXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIEFycmF5IFNjaGVtYVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXJyYXk8VD4oaXRlbTogU2NoZW1hPFQ+KTogU2NoZW1hPFRbXT4ge1xuICByZXR1cm4gbmV3IEFycmF5U2NoZW1hKGl0ZW0pO1xufVxuXG5jbGFzcyBNYXBTY2hlbWE8VD4gZXh0ZW5kcyBTY2hlbWE8TWFwPHN0cmluZywgVD4+IHtcbiAgcmVhZG9ubHkgX3NjaGVtYSE6IFNjaGVtYTxUPjtcbiAgY29uc3RydWN0b3Ioc2NoZW1hOiBTY2hlbWE8VD4pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX3NjaGVtYSA9IHNjaGVtYTtcbiAgfVxuICBwdWJsaWMgc2VyaWFsaXplSXRlbSgpOiBtYXJzaGFsbGVyLlNjaGVtYVR5cGUge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIk1hcFwiLFxuICAgICAgbWVtYmVyVHlwZTogdGhpcy5fc2NoZW1hLnNlcmlhbGl6ZUl0ZW0oKSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogTWFwIFNjaGVtYVxuICovXG5leHBvcnQgZnVuY3Rpb24gbWFwPFQ+KGl0ZW06IFNjaGVtYTxUPik6IFNjaGVtYTxNYXA8c3RyaW5nLCBUPj4ge1xuICByZXR1cm4gbmV3IE1hcFNjaGVtYShpdGVtKTtcbn1cblxuY2xhc3MgU2V0U2NoZW1hPFxuICBUIGV4dGVuZHMgQXJyYXlCdWZmZXIgfCBBcnJheUJ1ZmZlclZpZXcgfCBudW1iZXIgfCBzdHJpbmdcbj4gZXh0ZW5kcyBTY2hlbWE8U2V0PFQ+PiB7XG4gIHJlYWRvbmx5IF9zY2hlbWEhOiBTY2hlbWE8VD47XG4gIGNvbnN0cnVjdG9yKHNjaGVtYTogU2NoZW1hPFQ+KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9zY2hlbWEgPSBzY2hlbWE7XG4gIH1cblxuICBwcml2YXRlIG1lbWJlclR5cGUoKTogXCJTdHJpbmdcIiB8IFwiTnVtYmVyXCIgfCBcIkJpbmFyeVwiIHtcbiAgICBpZiAodGhpcy5fc2NoZW1hIGluc3RhbmNlb2YgQmluYXJ5U2NoZW1hKSB7XG4gICAgICByZXR1cm4gXCJCaW5hcnlcIjtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3NjaGVtYSBpbnN0YW5jZW9mIE51bWJlclNjaGVtYSkge1xuICAgICAgcmV0dXJuIFwiTnVtYmVyXCI7XG4gICAgfVxuICAgIGlmICh0aGlzLl9zY2hlbWEgaW5zdGFuY2VvZiBTdHJpbmdTY2hlbWEpIHtcbiAgICAgIHJldHVybiBcIlN0cmluZ1wiO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIFNldFwiKTtcbiAgfVxuICBwdWJsaWMgc2VyaWFsaXplSXRlbSgpOiBtYXJzaGFsbGVyLlNjaGVtYVR5cGUge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIlNldFwiLFxuICAgICAgbWVtYmVyVHlwZTogdGhpcy5tZW1iZXJUeXBlKCksXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFNldCBTY2hlbWFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldDxUIGV4dGVuZHMgQXJyYXlCdWZmZXIgfCBBcnJheUJ1ZmZlclZpZXcgfCBudW1iZXIgfCBzdHJpbmc+KFxuICBpdGVtOiBTY2hlbWE8VD5cbik6IFNjaGVtYTxTZXQ8VD4+IHtcbiAgcmV0dXJuIG5ldyBTZXRTY2hlbWEoaXRlbSk7XG59XG5cbmNsYXNzIE51bGxhYmxlU2NoZW1hPFQ+IGV4dGVuZHMgU2NoZW1hPFQgfCBudWxsPiB7XG4gIHJlYWRvbmx5IF9zY2hlbWEhOiBTY2hlbWE8VD47XG4gIGNvbnN0cnVjdG9yKHNjaGVtYTogU2NoZW1hPFQ+KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9zY2hlbWEgPSBzY2hlbWE7XG4gIH1cblxuICBwcml2YXRlIG1hcnNoYWxsKGlucHV0OiBUIHwgbnVsbCk6IEF0dHJpYnV0ZVZhbHVlIHtcbiAgICBpZiAoaW5wdXQgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIE5VTEw6IHRydWUsXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IHNlcmlhbGl6ZWQ6IEF0dHJpYnV0ZVZhbHVlIHwgdW5kZWZpbmVkID0gbWFyc2hhbGxlci5tYXJzaGFsbFZhbHVlKFxuICAgICAgdGhpcy5fc2NoZW1hLnNlcmlhbGl6ZUl0ZW0oKSxcbiAgICAgIGlucHV0XG4gICAgKTtcbiAgICBpZiAoc2VyaWFsaXplZCA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gbWFyc2hhbGxWYWx1ZVwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHNlcmlhbGl6ZWQ7XG4gIH1cblxuICBwcml2YXRlIHVubWFyc2hhbGwoaW5wdXQ6IEF0dHJpYnV0ZVZhbHVlKTogVCB8IG51bGwge1xuICAgIGlmIChcIk5VTExcIiBpbiBpbnB1dCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGRlc2VyaWFsaXplZDogeyBmb286IFQgfSA9IG1hcnNoYWxsZXIudW5tYXJzaGFsbEl0ZW0oXG4gICAgICB7IGZvbzogdGhpcy5fc2NoZW1hLnNlcmlhbGl6ZUl0ZW0oKSB9LFxuICAgICAgeyBmb286IGlucHV0IH1cbiAgICApO1xuICAgIHJldHVybiBkZXNlcmlhbGl6ZWQuZm9vO1xuICB9XG5cbiAgcHVibGljIHNlcmlhbGl6ZUl0ZW0oKTogbWFyc2hhbGxlci5TY2hlbWFUeXBlIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJDdXN0b21cIixcbiAgICAgIG1hcnNoYWxsOiB0aGlzLm1hcnNoYWxsLmJpbmQodGhpcyksXG4gICAgICB1bm1hcnNoYWxsOiB0aGlzLnVubWFyc2hhbGwuYmluZCh0aGlzKSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogTnVsbGFibGUgU2NoZW1hXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBudWxsYWJsZTxUPihpdGVtOiBTY2hlbWE8VD4pOiBTY2hlbWE8VCB8IG51bGw+IHtcbiAgcmV0dXJuIG5ldyBOdWxsYWJsZVNjaGVtYShpdGVtKTtcbn1cblxuLyoqXG4gKiBPYmplY3QgU2NoZW1hXG4gKi9cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG5leHBvcnQgY2xhc3MgT2JqZWN0U2NoZW1hPFQgZXh0ZW5kcyB7IFtrZXk6IHN0cmluZ106IGFueSB9PiBleHRlbmRzIFNjaGVtYTxUPiB7XG4gIHJlYWRvbmx5IF9zY2hlbWEhOiBBcnJheTxba2V5b2YgVCwgU2NoZW1hPFRba2V5b2YgVF0+XT47XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIHByaXZhdGUgY29uc3RydWN0b3Ioc2NoZW1hOiBBcnJheTxba2V5b2YgVCwgU2NoZW1hPGFueT5dPikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fc2NoZW1hID0gc2NoZW1hO1xuICB9XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXR5cGVzXG4gIHB1YmxpYyBzdGF0aWMgZW50cnk6IE9iamVjdFNjaGVtYTx7fT4gPSBuZXcgT2JqZWN0U2NoZW1hKFtdKTtcblxuICAvKiogQXNpZ24gcmVxdWlyZWQgZmllbGQuXG4gICAqXG4gICAqIE5vdGUgdGhhdCBgU2NoZW1hYCBjYW5ub3QgaGFuZGxlIG9iamVjdHMgd2l0aCBhbnkgb3B0aW9uYWwgZmllbGRzLlxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgcHVibGljIGZpZWxkPFYgZXh0ZW5kcyB7IFtrZXk6IHN0cmluZ106IGFueSB9PihcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgc2NoZW1hOiBTY2hlbWE8VltrZXlvZiBWXT5cbiAgKTogT2JqZWN0U2NoZW1hPFQgJiB7IFtrZXkgaW4ga2V5b2YgVl0tPzogVltrZXldIH0+IHtcbiAgICByZXR1cm4gbmV3IE9iamVjdFNjaGVtYTxUICYgeyBba2V5IGluIGtleW9mIFZdLT86IFZba2V5XSB9PihbXG4gICAgICAuLi50aGlzLl9zY2hlbWEsXG4gICAgICBbbmFtZSwgc2NoZW1hXSxcbiAgICBdKTtcbiAgfVxuICBwdWJsaWMgc2VyaWFsaXplVmFsdWUoKTogbWFyc2hhbGxlci5TY2hlbWEge1xuICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICB0aGlzLl9zY2hlbWEubWFwKChba2V5LCBzY2hlbWFdKSA9PiBba2V5LCBzY2hlbWEuc2VyaWFsaXplSXRlbSgpXSlcbiAgICApO1xuICB9XG4gIHB1YmxpYyBzZXJpYWxpemVJdGVtKCk6IG1hcnNoYWxsZXIuU2NoZW1hVHlwZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiRG9jdW1lbnRcIixcbiAgICAgIG1lbWJlcnM6IHRoaXMuc2VyaWFsaXplVmFsdWUoKSxcbiAgICB9O1xuICB9XG4gIHB1YmxpYyBtYXJzaGFsbEl0ZW0oaW5wdXQ6IFQpOiBBdHRyaWJ1dGVNYXAge1xuICAgIHJldHVybiBtYXJzaGFsbGVyLm1hcnNoYWxsSXRlbSh0aGlzLnNlcmlhbGl6ZVZhbHVlKCksIGlucHV0KTtcbiAgfVxuICBwdWJsaWMgdW5tYXJzaGFsbEl0ZW0oaW5wdXQ6IEF0dHJpYnV0ZU1hcCk6IFQge1xuICAgIGNvbnN0IHJldDogVCA9IG1hcnNoYWxsZXIudW5tYXJzaGFsbEl0ZW08VD4odGhpcy5zZXJpYWxpemVWYWx1ZSgpLCBpbnB1dCk7XG4gICAgLy8gSXQgc2VlbXMgdGhhdCBtYXJzaGFsbGVyLnVubWFyc2hhbGxJdGVtIGhhcyBhIGJ1Zy4uLlxuICAgIHRoaXMuX3NjaGVtYS5mb3JFYWNoKChba2V5XSkgPT4ge1xuICAgICAgaWYgKCEoa2V5IGluIHJldCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdSZXF1aXJlZCBBdHRyaWJ1dGUgXCInICsga2V5LnRvU3RyaW5nKCkgKyAnXCIgaXMgbm90IGZvdW5kLidcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmV0O1xuICB9XG59XG4iXX0=